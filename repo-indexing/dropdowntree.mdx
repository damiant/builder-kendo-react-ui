# DropDownTree Component

## Overview

### Purpose
Use this component to generate dropdown tree functionality

### When to Use
The DropDownTree component is ideal for scenarios where users need to select values from hierarchical data structures within a dropdown interface. Use this component when you need to:

- Allow users to select from multi-level categorized data (organizational charts, file systems, product categories)
- Provide a compact interface for navigating and selecting from tree structures
- Combine dropdown accessibility with tree navigation capabilities
- Enable filtering within hierarchical data for faster item location
- Support both single item selection from complex nested datasets
- Display parent-child relationships in data while maintaining a clean UI footprint

### Architecture
**No Coupling**: DropDownTree is a standalone component that doesn't require other components to function. It internally manages its own tree view and dropdown functionality without external dependencies.

## Components

### DropDownTree {Standalone Component}

**Purpose:** Provides a dropdown interface with embedded tree view functionality for selecting items from hierarchical data structures.

**Interface:**
```typescript
interface DropDownTreeProps extends FormComponentProps {
  // Data and Basic Configuration
  data?: any[]; // Array of hierarchical data items
  value?: any; // Selected value from the data tree
  dataItemKey: string; // Required - Key for comparing data items
  textField: string; // Required - Field name for item text display
  
  // Tree Structure Configuration
  subItemsField?: string; // Field name for subitems array (default: 'items')
  expandField?: string; // Field name for expanded state boolean
  selectField?: string; // Field name for selected state boolean
  
  // Display and Interaction
  placeholder?: string; // Hint text when no selection is made
  opened?: boolean; // Controls dropdown open/closed state
  disabled?: boolean; // Sets disabled state
  loading?: boolean; // Shows loading indicator
  
  // Filtering
  filterable?: boolean; // Enables search functionality
  filter?: string; // Controlled filter input value
  
  // Styling and Layout
  className?: string; // Additional CSS classes
  style?: React.CSSProperties; // Inline styles
  dir?: string; // Text direction ('ltr' | 'rtl')
  size?: null | 'small' | 'medium' | 'large'; // Component size
  
  // Accessibility
  id?: string; // Component identifier
  label?: string; // Floating label text
  ariaDescribedBy?: string; // ARIA described-by reference
  ariaLabelledBy?: string; // ARIA labelled-by reference
  tabIndex?: number; // Tab order
  accessKey?: string; // Keyboard shortcut
  
  // Popup Configuration
  popupSettings?: DropDownsPopupSettings; // Popup behavior settings
  
  // Data Mapping
  valueMap?: (value: any) => any; // Value transformation for form submission
  
  // Custom Rendering
  itemRender?: (element: React.ReactElement, itemProps: ItemRenderProps) => React.ReactNode;
  
  // Event Handlers
  onChange?: (event: DropDownTreeChangeEvent) => void; // Value selection change
  onOpen?: (event: DropDownTreeOpenEvent) => void; // Dropdown opening
  onClose?: (event: DropDownTreeCloseEvent) => void; // Dropdown closing
  onFocus?: (event: DropDownTreeFocusEvent) => void; // Component focus
  onBlur?: (event: DropDownTreeBlurEvent) => void; // Component blur
  onFilterChange?: (event: DropDownTreeFilterChangeEvent) => void; // Filter input change
  onExpandChange?: (event: DropDownTreeExpandEvent) => void; // Tree node expand/collapse
}
```

**Usage Example:**
```tsx
import { DropDownTree } from '@progress/kendo-react-dropdowns';

const hierarchicalData = [
  {
    id: 1,
    text: 'North America',
    expanded: true,
    items: [
      { id: 2, text: 'United States' },
      { id: 3, text: 'Canada' },
      { 
        id: 4, 
        text: 'Mexico',
        items: [
          { id: 5, text: 'Mexico City' },
          { id: 6, text: 'Guadalajara' }
        ]
      }
    ]
  },
  {
    id: 7,
    text: 'Europe',
    items: [
      { id: 8, text: 'Germany' },
      { id: 9, text: 'France' },
      { id: 10, text: 'United Kingdom' }
    ]
  }
];

function LocationSelector() {
  const [selectedLocation, setSelectedLocation] = React.useState(null);
  const [expanded, setExpanded] = React.useState({ 1: true });

  const handleChange = (event) => {
    setSelectedLocation(event.value);
  };

  const handleExpandChange = (event) => {
    setExpanded({
      ...expanded,
      [event.item.id]: !event.item.expanded
    });
  };

  return (
    <DropDownTree
      style={{ width: '300px' }}
      placeholder="Select a location..."
      data={hierarchicalData}
      value={selectedLocation}
      onChange={handleChange}
      onExpandChange={handleExpandChange}
      dataItemKey="id"
      textField="text"
      expandField="expanded"
      filterable={true}
    />
  );
}
```

## Integration Patterns

### Basic Tree Selection
```tsx
import { DropDownTree } from '@progress/kendo-react-dropdowns';

// Simple hierarchical data selection
function BasicTreeSelector() {
  const [value, setValue] = React.useState(null);

  const treeData = [
    {
      id: 1,
      name: 'Documents',
      children: [
        { id: 2, name: 'Personal' },
        { id: 3, name: 'Work' }
      ]
    },
    {
      id: 4,
      name: 'Images',
      children: [
        { id: 5, name: 'Vacation' },
        { id: 6, name: 'Projects' }
      ]
    }
  ];

  return (
    <DropDownTree
      data={treeData}
      value={value}
      onChange={(e) => setValue(e.value)}
      dataItemKey="id"
      textField="name"
      subItemsField="children"
      placeholder="Choose a folder..."
    />
  );
}
```

### Filtered Tree Navigation
```tsx
// Tree with built-in filtering capabilities
function FilterableTreeSelector() {
  const [value, setValue] = React.useState(null);
  const [filterValue, setFilterValue] = React.useState('');

  const departmentData = [
    {
      id: 'eng',
      title: 'Engineering',
      teams: [
        { id: 'fe', title: 'Frontend Team' },
        { id: 'be', title: 'Backend Team' },
        { id: 'qa', title: 'QA Team' }
      ]
    },
    {
      id: 'sales',
      title: 'Sales',
      teams: [
        { id: 'inside', title: 'Inside Sales' },
        { id: 'field', title: 'Field Sales' }
      ]
    }
  ];

  return (
    <DropDownTree
      data={departmentData}
      value={value}
      onChange={(e) => setValue(e.value)}
      filter={filterValue}
      onFilterChange={(e) => setFilterValue(e.filter)}
      dataItemKey="id"
      textField="title"
      subItemsField="teams"
      filterable={true}
      placeholder="Search departments..."
      style={{ width: '250px' }}
    />
  );
}
```

### Dynamic Tree Loading
```tsx
// Tree with dynamic data loading and expansion state management
function DynamicTreeSelector() {
  const [value, setValue] = React.useState(null);
  const [expanded, setExpanded] = React.useState({});
  const [loading, setLoading] = React.useState(false);

  const organizationData = [
    {
      id: 'ceo',
      position: 'CEO',
      hasReports: true,
      expanded: expanded['ceo'],
      reports: expanded['ceo'] ? [
        { id: 'cto', position: 'CTO', hasReports: true },
        { id: 'cfo', position: 'CFO', hasReports: false }
      ] : []
    }
  ];

  const handleExpandChange = async (event) => {
    if (event.item.hasReports && !expanded[event.item.id]) {
      setLoading(true);
      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 500));
      setLoading(false);
    }
    
    setExpanded({
      ...expanded,
      [event.item.id]: !event.item.expanded
    });
  };

  return (
    <DropDownTree
      data={organizationData}
      value={value}
      onChange={(e) => setValue(e.value)}
      onExpandChange={handleExpandChange}
      dataItemKey="id"
      textField="position"
      subItemsField="reports"
      expandField="expanded"
      loading={loading}
      placeholder="Select organization member..."
      style={{ width: '300px' }}
    />
  );
}
```

### Custom Item Rendering
```tsx
// Tree with custom item display and icons
function CustomRenderedTree() {
  const [value, setValue] = React.useState(null);

  const fileSystemData = [
    {
      id: 1,
      name: 'Documents',
      type: 'folder',
      items: [
        { id: 2, name: 'report.pdf', type: 'file', size: '2.5MB' },
        { id: 3, name: 'presentation.pptx', type: 'file', size: '5.1MB' }
      ]
    },
    {
      id: 4,
      name: 'Downloads',
      type: 'folder',
      items: [
        { id: 5, name: 'installer.exe', type: 'file', size: '125MB' }
      ]
    }
  ];

  const itemRender = (element, itemProps) => {
    const { dataItem } = itemProps;
    const icon = dataItem.type === 'folder' ? 'folder' : 'file';
    
    return React.cloneElement(element, {
      children: (
        <span>
          <span className={`k-icon k-i-${icon}`}></span>
          <span>{dataItem.name}</span>
          {dataItem.size && <span className="file-size">({dataItem.size})</span>}
        </span>
      )
    });
  };

  return (
    <DropDownTree
      data={fileSystemData}
      value={value}
      onChange={(e) => setValue(e.value)}
      dataItemKey="id"
      textField="name"
      itemRender={itemRender}
      placeholder="Browse files..."
      style={{ width: '350px' }}
    />
  );
}
```

## Best Practices

### Usage Guidelines
- Always provide both `dataItemKey` and `textField` props as they are required for proper component operation
- Use meaningful field names that clearly represent the data structure (e.g., 'children', 'subCategories', 'items')
- Enable filtering (`filterable={true}`) for large datasets to improve user experience and item discoverability
- Implement controlled expansion state management for dynamic loading scenarios or when you need to persist tree state
- Consider the appropriate size prop based on your application's design scale and available screen space

### Accessibility
- Provide descriptive placeholder text that clearly indicates the purpose of the selection
- Use the `label` prop for floating labels or `ariaLabelledBy` to connect with external labels
- Set appropriate `ariaDescribedBy` attributes to connect with help text or error messages
- Ensure that custom item rendering maintains proper ARIA attributes and semantic structure
- Test keyboard navigation thoroughly, especially with complex tree structures

### Performance
- Use `dataItemKey` prop for efficient item comparison instead of relying on reference equality
- Implement lazy loading patterns for large tree structures using the `onExpandChange` event
- Consider virtualizing very large datasets or implementing server-side filtering for massive hierarchies
- Optimize custom item rendering functions to avoid unnecessary re-renders using React.memo when appropriate
- Use controlled filtering state when implementing custom filter logic or server-side search

## Common Patterns

### Pattern 1: Organizational Hierarchy Selector
```tsx
// Organization structure selection with role-based filtering
function OrganizationSelector({ userRole }) {
  const [selectedEmployee, setSelectedEmployee] = React.useState(null);
  const [expandedNodes, setExpandedNodes] = React.useState({ root: true });

  const organizationTree = [
    {
      id: 'root',
      name: 'Company',
      role: 'organization',
      expanded: expandedNodes.root,
      members: [
        {
          id: 'exec-1',
          name: 'John Smith',
          role: 'CEO',
          department: 'Executive',
          members: [
            { id: 'eng-lead', name: 'Sarah Johnson', role: 'Engineering Manager' },
            { id: 'sales-lead', name: 'Mike Wilson', role: 'Sales Director' }
          ]
        }
      ]
    }
  ];

  const handleExpandChange = (event) => {
    setExpandedNodes({
      ...expandedNodes,
      [event.item.id]: !event.item.expanded
    });
  };

  const itemRender = (element, itemProps) => {
    const { dataItem } = itemProps;
    return React.cloneElement(element, {
      children: (
        <div className="org-item">
          <span className="name">{dataItem.name}</span>
          <span className="role">{dataItem.role}</span>
        </div>
      )
    });
  };

  return (
    <DropDownTree
      data={organizationTree}
      value={selectedEmployee}
      onChange={(e) => setSelectedEmployee(e.value)}
      onExpandChange={handleExpandChange}
      dataItemKey="id"
      textField="name"
      subItemsField="members"
      expandField="expanded"
      itemRender={itemRender}
      filterable={true}
      placeholder="Select team member..."
      style={{ width: '400px' }}
      ariaLabel="Organization hierarchy selector"
    />
  );
}
```

### Pattern 2: Category-Based Product Selector
```tsx
// E-commerce category navigation with product selection
function ProductCategorySelector({ onProductSelect }) {
  const [selectedProduct, setSelectedProduct] = React.useState(null);
  const [filter, setFilter] = React.useState('');

  const productCategories = [
    {
      id: 'electronics',
      categoryName: 'Electronics',
      products: [
        {
          id: 'laptops',
          categoryName: 'Laptops',
          products: [
            { id: 'laptop-1', productName: 'MacBook Pro 16"', price: '$2499' },
            { id: 'laptop-2', productName: 'Dell XPS 13', price: '$1299' }
          ]
        },
        {
          id: 'phones',
          categoryName: 'Smartphones',
          products: [
            { id: 'phone-1', productName: 'iPhone 15 Pro', price: '$999' },
            { id: 'phone-2', productName: 'Samsung Galaxy S24', price: '$899' }
          ]
        }
      ]
    },
    {
      id: 'clothing',
      categoryName: 'Clothing',
      products: [
        { id: 'shirts', productName: 'T-Shirts', price: '$25-50' },
        { id: 'jeans', productName: 'Denim Jeans', price: '$60-120' }
      ]
    }
  ];

  const handleProductChange = (event) => {
    setSelectedProduct(event.value);
    if (onProductSelect && event.value) {
      onProductSelect(event.value);
    }
  };

  const productItemRender = (element, itemProps) => {
    const { dataItem } = itemProps;
    const isProduct = !dataItem.products || dataItem.products.length === 0;
    
    return React.cloneElement(element, {
      children: (
        <div className={`category-item ${isProduct ? 'product' : 'category'}`}>
          <span className="name">
            {dataItem.productName || dataItem.categoryName}
          </span>
          {dataItem.price && (
            <span className="price">{dataItem.price}</span>
          )}
        </div>
      )
    });
  };

  return (
    <DropDownTree
      data={productCategories}
      value={selectedProduct}
      onChange={handleProductChange}
      filter={filter}
      onFilterChange={(e) => setFilter(e.filter)}
      dataItemKey="id"
      textField="categoryName"
      subItemsField="products"
      itemRender={productItemRender}
      filterable={true}
      placeholder="Browse products by category..."
      size="large"
      style={{ width: '450px' }}
    />
  );
}
```

### Pattern 3: File System Browser
```tsx
// File and folder navigation with type filtering
function FileBrowser({ allowedTypes = [] }) {
  const [selectedItem, setSelectedItem] = React.useState(null);
  const [expanded, setExpanded] = React.useState({ root: true });

  const fileSystemStructure = [
    {
      id: 'root',
      fileName: 'My Documents',
      fileType: 'folder',
      expanded: expanded.root,
      children: [
        {
          id: 'images',
          fileName: 'Images',
          fileType: 'folder',
          children: [
            { id: 'img1', fileName: 'vacation.jpg', fileType: 'image', size: '2.4 MB' },
            { id: 'img2', fileName: 'profile.png', fileType: 'image', size: '156 KB' }
          ]
        },
        {
          id: 'documents',
          fileName: 'Documents',
          fileType: 'folder',
          children: [
            { id: 'doc1', fileName: 'resume.pdf', fileType: 'pdf', size: '245 KB' },
            { id: 'doc2', fileName: 'report.docx', fileType: 'document', size: '1.2 MB' }
          ]
        },
        { id: 'readme', fileName: 'readme.txt', fileType: 'text', size: '1 KB' }
      ]
    }
  ];

  const filterData = (items) => {
    if (allowedTypes.length === 0) return items;
    
    return items.map(item => {
      if (item.fileType === 'folder') {
        return {
          ...item,
          children: item.children ? filterData(item.children) : []
        };
      }
      return allowedTypes.includes(item.fileType) ? item : null;
    }).filter(Boolean);
  };

  const handleExpandChange = (event) => {
    setExpanded({
      ...expanded,
      [event.item.id]: !event.item.expanded
    });
  };

  const fileItemRender = (element, itemProps) => {
    const { dataItem } = itemProps;
    const iconClass = dataItem.fileType === 'folder' 
      ? 'k-i-folder' 
      : `k-i-file-${dataItem.fileType}`;

    return React.cloneElement(element, {
      children: (
        <div className="file-item">
          <span className={`k-icon ${iconClass}`}></span>
          <span className="file-name">{dataItem.fileName}</span>
          {dataItem.size && (
            <span className="file-size">({dataItem.size})</span>
          )}
        </div>
      )
    });
  };

  return (
    <DropDownTree
      data={filterData(fileSystemStructure)}
      value={selectedItem}
      onChange={(e) => setSelectedItem(e.value)}
      onExpandChange={handleExpandChange}
      dataItemKey="id"
      textField="fileName"
      subItemsField="children"
      expandField="expanded"
      itemRender={fileItemRender}
      filterable={true}
      placeholder="Select a file or folder..."
      style={{ width: '400px' }}
      ariaLabel="File system browser"
    />
  );
}
```
